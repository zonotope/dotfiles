;; -*-lisp-*-

(in-package :stumpwm)

(set-focus-color "dimgray")
(set-font "-*-liberation mono-*-r-*-*-*-*-100-100-*-*-*-*")
(setf *hidden-window-color* "^6*")
(setf *window-border-style* :thin) ; :none, :thick, :thin, :tight

(setf *message-window-gravity* :center) ; :top-left :top-right :bottom-left
                                        ; :bottom-right :center

(setf *input-window-gravity* :center) ; :top-left :top-right :bottom-left
                                      ; :bottom-right :center

;; mode line
(setf *mode-line-position* :top)
(setf *window-format* "[%m%s%n: %c (%20t..)]")
(setf *screen-mode-line-format* "%v")
(if (not (head-mode-line (current-head)))
    (toggle-mode-line (current-screen) (current-head)))

;; set the mouse policy to focus follows mouse;
(setf *mouse-focus-policy* :sloppy) ; :click, :ignore, :sloppy

;; in seconds, how long a message will appear for.
(setf *timeout-wait* 5)

;; what shows up in the middle of a newly focused frame
(setf *frame-indicator-text* " boom! ")

(setf *min-frame-height* 20)


;;;; bindings:
(set-prefix-key (kbd "C-t"))

(define-key *root-map* (kbd "b") "exec chromium")

;; dmenu is a better launcher than the built in
(define-key *root-map* (kbd "RET") "exec dmenu_run -fn \"-*-liberation mono-*-r-*-*-*-*-100-100-*-*-*-*\"")


(setq *terminal* "uxterm")
(setq *browser* "chromium")

;;;; start a swank server so emacs can connect

;; load swank
;; TODO: figure out how to load swank with quicklist instead of the brittle path.
(load "/usr/local/share/sbcl/dists/quicklisp/software/slime-2.11/swank-loader.lisp")
(swank-loader:init)

(defcommand swank () ()
  (swank:create-server :port 4005
                       :style swank:*communication-style*
                       :dont-close t)
  (echo-string (current-screen)
	       "Starting swank. M-x slime-connect RET RET, then (in-package stumpwm)."))
(swank)

;;; Define window placement policy...

;; Clear rules
(clear-window-placement-rules)

;; Last rule to match takes precedence!
;; TIP: if the argument to :title or :role begins with an ellipsis, a substring
;; match is performed.
;; TIP: if the :create flag is set then a missing group will be created and
;; restored from *data-dir*/create file.
;; TIP: if the :restore flag is set then group dump is restored even for an
;; existing group using *data-dir*/restore file.
;; (define-frame-preference "Default"
;;   ;; frame raise lock (lock AND raise == jumpto)
;;   (0 t nil :class "Konqueror" :role "...konqueror-mainwindow")
;;   (1 t nil :class "XTerm"))

;; (define-frame-preference "Ardour"
;;   (0 t   t   :instance "ardour_editor" :type :normal)
;;   (0 t   t   :title "Ardour - Session Control")
;;   (0 nil nil :class "XTerm")
;;   (1 t   nil :type :normal)
;;   (1 t   t   :instance "ardour_mixer")
;;   (2 t   t   :instance "jvmetro")
;;   (1 t   t   :instance "qjackctl")
;;   (3 t   t   :instance "qjackctl" :role "qjackctlMainForm"))

;; (define-frame-preference "Shareland"
;;   (0 t   nil :class "XTerm")
;;   (1 nil t   :class "aMule"))

;; (define-frame-preference "Emacs"
;;   (1 t t :restore "emacs-editing-dump" :title "...xdvi")
;;   (0 t t :create "emacs-dump" :class "Emacs"))
